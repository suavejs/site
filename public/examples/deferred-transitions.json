{"title":"Deferred transitions","files":[{"name":"App.svelte","source":"<script>\n\timport { quintOut } from 'svelte/easing';\n\timport crossfade from './crossfade.js'; // TODO put this in svelte/transition!\n\n\tconst { send, receive } = crossfade({\n\t\tfallback(node, params) {\n\t\t\tconst style = getComputedStyle(node);\n\t\t\tconst transform = style.transform === 'none' ? '' : style.transform;\n\n\t\t\treturn {\n\t\t\t\tduration: 600,\n\t\t\t\teasing: quintOut,\n\t\t\t\tcss: t => `\n\t\t\t\t\ttransform: ${transform} scale(${t});\n\t\t\t\t\topacity: ${t}\n\t\t\t\t`\n\t\t\t};\n\t\t}\n\t});\n\n\tlet todos = [\n\t\t{ id: 1, done: false, description: 'write some docs' },\n\t\t{ id: 2, done: false, description: 'start writing JSConf talk' },\n\t\t{ id: 3, done: true, description: 'buy some milk' },\n\t\t{ id: 4, done: false, description: 'mow the lawn' },\n\t\t{ id: 5, done: false, description: 'feed the turtle' },\n\t\t{ id: 6, done: false, description: 'fix some bugs' },\n\t];\n\n\tlet uid = todos.length + 1;\n\n\tfunction add(input) {\n\t\tconst todo = {\n\t\t\tid: uid++,\n\t\t\tdone: false,\n\t\t\tdescription: input.value\n\t\t};\n\n\t\ttodos = [todo, ...todos];\n\t\tinput.value = '';\n\t}\n\n\tfunction remove(todo) {\n\t\ttodos = todos.filter(t => t !== todo);\n\t}\n</script>\n\n<style>\n\t.new-todo {\n\t\tfont-size: 1.4em;\n\t\twidth: 100%;\n\t\tmargin: 2em 0 1em 0;\n\t}\n\n\t.board {\n\t\tmax-width: 36em;\n\t\tmargin: 0 auto;\n\t}\n\n\t.left, .right {\n\t\tfloat: left;\n\t\twidth: 50%;\n\t\tpadding: 0 1em 0 0;\n\t\tbox-sizing: border-box;\n\t}\n\n\th2 {\n\t\tfont-size: 2em;\n\t\tfont-weight: 200;\n\t\tuser-select: none;\n\t}\n\n\tlabel {\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tdisplay: block;\n\t\tfont-size: 1em;\n\t\tline-height: 1;\n\t\tpadding: 0.5em;\n\t\tmargin: 0 auto 0.5em auto;\n\t\tborder-radius: 2px;\n\t\tbackground-color: #eee;\n\t\tuser-select: none;\n\t}\n\n\tinput { margin: 0 }\n\n\t.right label {\n\t\tbackground-color: rgb(180,240,100);\n\t}\n\n\tbutton {\n\t\tfloat: right;\n\t\theight: 1em;\n\t\tbox-sizing: border-box;\n\t\tpadding: 0 0.5em;\n\t\tline-height: 1;\n\t\tbackground-color: transparent;\n\t\tborder: none;\n\t\tcolor: rgb(170,30,30);\n\t\topacity: 0;\n\t\ttransition: opacity 0.2s;\n\t}\n\n\tlabel:hover button {\n\t\topacity: 1;\n\t}\n</style>\n\n<div class='board'>\n\t<input class=\"new-todo\" placeholder=\"what needs to be done?\" on:keydown=\"{event => event.which === 13 && add(event.target)}\">\n\n\t<div class='left'>\n\t\t<h2>todo</h2>\n\t\t{#each todos.filter(t => !t.done) as todo (todo.id)}\n\t\t\t<label\n\t\t\t\tin:receive=\"{{key: todo.id}}\"\n\t\t\t\tout:send=\"{{key: todo.id}}\"\n\t\t\t>\n\t\t\t\t<input type=checkbox bind:checked={todo.done}>\n\t\t\t\t{todo.description}\n\t\t\t\t<button on:click=\"{() => remove(todo)}\">x</button>\n\t\t\t</label>\n\t\t{/each}\n\t</div>\n\n\t<div class='right'>\n\t\t<h2>done</h2>\n\t\t{#each todos.filter(t => t.done) as todo (todo.id)}\n\t\t\t<label\n\t\t\t\tin:receive=\"{{key: todo.id}}\"\n\t\t\t\tout:send=\"{{key: todo.id}}\"\n\t\t\t>\n\t\t\t\t<input type=checkbox bind:checked={todo.done}>\n\t\t\t\t{todo.description}\n\t\t\t\t<button on:click=\"{() => remove(todo)}\">x</button>\n\t\t\t</label>\n\t\t{/each}\n\t</div>\n</div>"},{"name":"crossfade.js","source":"import { quintOut } from 'svelte/easing';\n\nexport default function crossfade({ send, receive, fallback }) {\n\tlet requested = new Map();\n\tlet provided = new Map();\n\n\tfunction crossfade(from, node) {\n\t\tconst to = node.getBoundingClientRect();\n\t\tconst dx = from.left - to.left;\n\t\tconst dy = from.top - to.top;\n\n\t\tconst style = getComputedStyle(node);\n\t\tconst transform = style.transform === 'none' ? '' : style.transform;\n\n\t\treturn {\n\t\t\tduration: 400,\n\t\t\teasing: quintOut,\n\t\t\tcss: (t, u) => `\n\t\t\t\topacity: ${t};\n\t\t\t\ttransform: ${transform} translate(${u * dx}px,${u * dy}px);\n\t\t\t`\n\t\t};\n\t}\n\n\treturn {\n\t\tsend(node, params) {\n\t\t\tprovided.set(params.key, {\n\t\t\t\trect: node.getBoundingClientRect()\n\t\t\t});\n\n\t\t\treturn () => {\n\t\t\t\tif (requested.has(params.key)) {\n\t\t\t\t\tconst { rect } = requested.get(params.key);\n\t\t\t\t\trequested.delete(params.key);\n\n\t\t\t\t\treturn crossfade(rect, node);\n\t\t\t\t}\n\n\t\t\t\t// if the node is disappearing altogether\n\t\t\t\t// (i.e. wasn't claimed by the other list)\n\t\t\t\t// then we need to supply an outro\n\t\t\t\tprovided.delete(params.key);\n\t\t\t\treturn fallback(node, params);\n\t\t\t};\n\t\t},\n\n\t\treceive(node, params) {\n\t\t\trequested.set(params.key, {\n\t\t\t\trect: node.getBoundingClientRect()\n\t\t\t});\n\n\t\t\treturn () => {\n\t\t\t\tif (provided.has(params.key)) {\n\t\t\t\t\tconst { rect } = provided.get(params.key);\n\t\t\t\t\tprovided.delete(params.key);\n\n\t\t\t\t\treturn crossfade(rect, node);\n\t\t\t\t}\n\n\t\t\t\trequested.delete(params.key);\n\t\t\t\treturn fallback(node, params);\n\t\t\t};\n\t\t}\n\t};\n}"}]}