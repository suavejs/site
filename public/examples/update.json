{"title":"beforeUpdate and afterUpdate","files":[{"name":"App.svelte","source":"<script>\n\timport Eliza from 'elizabot';\n\timport { beforeUpdate, afterUpdate } from 'svelte';\n\n\tlet div;\n\tlet autoscroll;\n\n\tbeforeUpdate(() => {\n\t\tautoscroll = div && (div.offsetHeight + div.scrollTop) > (div.scrollHeight - 20);\n\t});\n\n\tafterUpdate(() => {\n\t\tif (autoscroll) div.scrollTo(0, div.scrollHeight);\n\t});\n\n\tconst eliza = new Eliza();\n\n\tlet comments = [\n\t\t{ author: 'eliza', text: eliza.getInitial() }\n\t];\n\n\tfunction handleKeydown(event) {\n\t\tif (event.which === 13) {\n\t\t\tconst text = event.target.value;\n\t\t\tif (!text) return;\n\n\t\t\tcomments = comments.concat({\n\t\t\t\tauthor: 'user',\n\t\t\t\ttext\n\t\t\t});\n\n\t\t\tevent.target.value = '';\n\n\t\t\tconst reply = eliza.transform(text);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tcomments = comments.concat({\n\t\t\t\t\tauthor: 'eliza',\n\t\t\t\t\ttext: '...',\n\t\t\t\t\tplaceholder: true\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcomments = comments.filter(comment => !comment.placeholder).concat({\n\t\t\t\t\t\tauthor: 'eliza',\n\t\t\t\t\t\ttext: reply\n\t\t\t\t\t});\n\t\t\t\t}, 500 + Math.random() * 500);\n\t\t\t}, 200 + Math.random() * 200);\n\t\t}\n\t}\n</script>\n\n<style>\n\t.chat {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\theight: 100%;\n\t\tmax-width: 320px;\n\t}\n\n\t.scrollable {\n\t\tflex: 1 1 auto;\n\t\tborder-top: 1px solid #eee;\n\t\tmargin: 0 0 0.5em 0;\n\t\toverflow-y: auto;\n\t}\n\n\tarticle {\n\t\tmargin: 0.5em 0;\n\t}\n\n\t.user {\n\t\ttext-align: right;\n\t}\n\n\tspan {\n\t\tpadding: 0.5em 1em;\n\t\tdisplay: inline-block;\n\t}\n\n\t.eliza span {\n\t\tbackground-color: #eee;\n\t\tborder-radius: 1em 1em 1em 0;\n\t}\n\n\t.user span {\n\t\tbackground-color: #0074D9;\n\t\tcolor: white;\n\t\tborder-radius: 1em 1em 0 1em;\n\t}\n</style>\n\n<div class=\"chat\">\n\t<h1>Eliza</h1>\n\n\t<div class=\"scrollable\" bind:this={div}>\n\t\t{#each comments as comment}\n\t\t\t<article class={comment.author}>\n\t\t\t\t<span>{comment.text}</span>\n\t\t\t</article>\n\t\t{/each}\n\t</div>\n\n\t<input on:keydown={handleKeydown}>\n</div>"}]}